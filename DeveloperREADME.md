# AI Music Generator Developer Readme

This readme provides detailed information for developers who want to understand the underlying structure and advanced functionalities of the AI Music Generator plugin. It explains the software requirements, setting up the model, using the model, installing and running the MuseScore plugin, limitations, and the data conversion process.

## Software Requirements

To develop and use the AI Music Generator plugin, you need the following software:

- [MuseScore 3.x](https://musescore.org/en/3.6.2) (3.6.x preferred) - A music notation software
- macOS 11 or later - Operating system
- [Magenta](https://github.com/magenta/magenta/blob/main/README.md) - A Python library for music and art generation
- [py_midicsv](https://pypi.org/project/py-midicsv/) - A Python library for converting MIDI files to CSV format
- Our GitHub library - Clone the repository from [here](https://github.com/abbynewcomb/MuseScore-Music-Generation-Extension.git)

## Setting up the Model

Follow these steps to set up the model:

1. Open Terminal and clone our GitHub library using the command: `git clone https://github.com/abbynewcomb/MuseScore-Music-Generation-Extension.git`. Navigate to the main directory.
2. Download the MelodyRNN model from [this link](http://download.magenta.tensorflow.org/models/basic_rnn.mag) and save it in the main directory.
3. Run the command `source activate magenta` to activate the Magenta environment.

## Using the Model

To use the model, follow these steps:

1. In the main directory of our GitHub library, run the terminal command `python generator.py`. This initializes the model.
2. Keep the terminal window running while using the MuseScore plugin. It will wait for the plugin to request a generated sequence.
3. To exit the generator, press Ctrl-C.

## MuseScore Plugin

### Installing the Plugin

To install the MuseScore plugin, follow these steps:

1. Copy the plugin file `AIMusicGenerator.qml` to the `/Users/[username]/Documents/MuseScore3/Plugins/` directory.
2. In MuseScore, navigate to Plugins > Plugin Manager at the top of your screen.
3. In the left window of the Plugin Manager, check the box for `AI Music Generator` and click OK.

### Running the Plugin

To run the MuseScore plugin and generate music, follow these steps:

1. Follow the instructions in the "Using the Model" section of this document.
2. Select the portion of the score you want to use as the "seed melody" for the model using your cursor. Ensure that you select full measures only and leave enough empty measures after the selection for the generated music.
3. In the plugin window, select the number of measures you want the model to generate using the - and + buttons. Note that generating more measures may take longer.
4. Adjust the complexity slider to control the complexity of the generated music. Less complex music is on the left, and more complex music is on the right.
5. Click the generate button to initiate the model and wait for the generated result.
6. Repeat the process as needed and press Quit to stop the plugin.

## Limitations

The AI Music Generator plugin has the following limitations:

- Only notes longer than 16th notes can be generated by the model.
- Triplets or any other kind of tuplet cannot be read from the model.
- The current model supports generating only one staff/melody at a time, although the plugin supports multi-staff input/output.

## Data Conversion

The plugin requires data conversion between CSV and MIDI formats. Here is an overview of the conversion process:

- The plugin uses the py_midicsv library to convert MuseScore data from CSV to MIDI format.
- The model requires a custom CSV format with specific requirements (track, tick, pitch, velocity) to generate music.
- The converted CSV format represents the beginning and end of a note using the velocity value (greater than zero for the start and zero for the end).
- The plugin rounds the tick values in the CSV to the nearest 60 ticks (duration of a 32nd note) to align with the model's expectations.
- Reading from the score involves accessing notes using the MuseScore API and cursor position, retrieving information such as tick position, note duration, pitch, and track.
- Writing to the score is similar to reading, with the cursor used to set the tick position, pitch, track, and duration of the notes. Chords are handled to ensure proper note placement.

## Magenta

The AI Music Generator plugin utilizes the Magenta library, specifically the Melody RNN model, to generate music. The Melody RNN model is a simple RNN model trained on note sequences using the Python note-seq library. The Magenta library provides functions to generate note sequences based on the trained model.

For more information on using Magenta, refer to the Magenta website and example Google Colab notebooks provided by the developers.

## Monitoring for MuseScore Plugin Generation Request

To establish communication between the MuseScore plugin and the generator script, the generator monitors the CSV file written by the plugin. It checks the file's last edited time and generates a new sequence if the file has been modified. This monitoring process ensures the generator can respond to user requests for generating new music sequences.

---

This developer readme provides comprehensive information on the AI Music Generator plugin, including software requirements, setting up the model, using the model, installing and running the MuseScore plugin, limitations, and data conversion details. Developers can refer to this document to understand the plugin's functionalities and integrate it into their projects effectively.
